<VirtualHost *:80>
    ServerName crm.ohmatdyt.com.ua
    
    # Redirect all HTTP to HTTPS
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}$1 [R=301,L]
</VirtualHost>

<VirtualHost *:443>
    ServerName crm.ohmatdyt.com.ua
    
    # SSL Configuration (if Apache handles SSL)
    SSLEngine on
    SSLCertificateFile /home/crm/ohmatdyt-crm/ohmatdyt-crm/nginx/ssl/cert.pem
    SSLCertificateKeyFile /home/crm/ohmatdyt-crm/ohmatdyt-crm/nginx/ssl/key.pem
    SSLCertificateChainFile /home/crm/ohmatdyt-crm/ohmatdyt-crm/nginx/ssl/ca_bundle.crt
    
    # Reverse Proxy to Docker Nginx
    ProxyPreserveHost On
    ProxyPass / https://localhost:8443/
    ProxyPassReverse / https://localhost:8443/
    
    # SSL Proxy settings
    SSLProxyEngine On
    SSLProxyVerify none
    SSLProxyCheckPeerCN off
    SSLProxyCheckPeerName off
    
    # Proxy headers
    RequestHeader set X-Forwarded-Proto "https"
    RequestHeader set X-Forwarded-Port "443"
    
    # Logging
    ErrorLog ${APACHE_LOG_DIR}/crm.ohmatdyt.com.ua-error.log
    CustomLog ${APACHE_LOG_DIR}/crm.ohmatdyt.com.ua-access.log combined
</VirtualHost>
