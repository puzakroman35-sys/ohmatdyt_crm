# BE-017: Розширені права адміністратора для керування зверненнями

Фаза: 1 (MVP)
Тип: Backend

## Мета
Реалізувати backend логіку для повного доступу адміністратора до всіх звернень з можливістю редагування полів, зміни статусів та управління відповідальними.

## Скоуп
- Правила доступу для ADMIN:
  - ADMIN бачить всі звернення в системі без фільтрації
  - ADMIN може змінювати статус будь-якого звернення
  - ADMIN може редагувати всі поля звернення
  - ADMIN може призначати/змінювати/знімати відповідальних

- Ендпоінт редагування звернення:
  - PATCH /cases/{public_id} для оновлення полів звернення
  - Доступні поля для редагування: category_id, subcategory_id, channel_id, name, phone, email, description
  - Валідація всіх полів (як при створенні)
  - Доступно тільки для ролі ADMIN

- Розширена зміна статусів:
  - ADMIN може змінювати статус без обмежень на відповідального
  - ADMIN може повертати звернення в статус "Нове" з обнуленням assigned_to
  - Всі зміни статусів логуються з інформацією про адміністратора

- Управління відповідальним:
  - PATCH /cases/{public_id}/assign для призначення відповідального
  - Параметр: assigned_to_id (user_id виконавця або null)
  - Валідація: користувач має бути EXECUTOR або ADMIN
  - При призначенні статус автоматично змінюється на "В роботі"
  - При зняті відповідального (null) статус повертається в "Нове"

- Валідації та обмеження:
  - Перевірка існування категорії, підкатегорії, каналу
  - Перевірка формату контактних даних (email, телефон)
  - Валідація довжини полів
  - Логування всіх змін в історію звернення

## Необхідні зміни API
- PATCH /cases/{public_id} - редагування полів звернення (тільки ADMIN)
- PATCH /cases/{public_id}/assign - призначення/зняття відповідального (тільки ADMIN)
- Модифікація GET /cases - для ADMIN без фільтрації по assigned_to
- Модифікація PATCH /cases/{public_id}/status - для ADMIN без обмежень

## Вимоги/обмеження
- Тільки роль ADMIN має доступ до редагування полів
- Всі зміни мають бути атомарними (транзакції)
- Логування всіх змін (хто, коли, що змінив)
- Валідація на рівні моделі та API
- Повернення повних даних звернення після успішного оновлення

## Визначення готовності (DoD)
- GET /cases для ADMIN повертає всі звернення без фільтрації
- PATCH /cases/{public_id} дозволяє ADMIN редагувати поля звернення
- PATCH /cases/{public_id}/assign дозволяє призначати/знімати відповідальних
- PATCH /cases/{public_id}/status для ADMIN працює без обмежень
- Валідації працюють коректно
- Всі зміни логуються
- Non-ADMIN ролі отримують 403 при спробі редагувати
- Історія змін зберігає інформацію про редагування

## Тести
- ADMIN отримує список всіх звернень
- ADMIN може редагувати категорію звернення
- ADMIN може редагувати контактні дані звернення
- ADMIN може редагувати суть звернення
- ADMIN може призначити виконавця на нове звернення
- ADMIN може змінити відповідального виконавця
- ADMIN може зняти відповідального (assigned_to = null)
- ADMIN може змінити статус будь-якого звернення
- ADMIN може повернути звернення в статус "Нове"
- EXECUTOR/OPERATOR отримують 403 при спробі редагувати поля
- Валідація полів працює (невалідний email, category_id і т.д.)
- Історія змін містить всі редагування

## Залежності
- BE-003 (модель Case)
- BE-007 (управління статусами)
- BE-008 (RBAC permissions)
- BE-016 (правила доступу виконавця)

## Позначки
- RBAC, Admin, Permissions, Edit, Status, Assignment, Full Access
