# BE-018: Модель доступу виконавців до категорій

Фаза: 1 (MVP - розширення)
Тип: Backend

## Мета
Створити модель для управління доступом виконавців до категорій та реалізувати API для адміністратора щодо управління цими доступами.

## Скоуп
- Створення моделі ExecutorCategoryAccess:
  - executor (ForeignKey до User, де role=EXECUTOR)
  - category (ForeignKey до Category)
  - created_at, updated_at
  - Унікальна комбінація executor + category
  
- API ендпоінти для ADMIN:
  - GET /users/{user_id}/category-access - отримати список доступних категорій для виконавця
  - POST /users/{user_id}/category-access - додати доступ виконавцю до категорій (масове додавання)
    - Приймає список category_ids
  - DELETE /users/{user_id}/category-access/{category_id} - видалити доступ до конкретної категорії
  - PUT /users/{user_id}/category-access - замінити всі доступи виконавця (масове оновлення)
    - Приймає список category_ids, видаляє старі та створює нові
  
- Валідації:
  - Перевірка, що user_id належить користувачу з роллю EXECUTOR
  - Перевірка існування категорії
  - Перевірка унікальності пари executor-category
  - Доступ до ендпоінтів тільки для ADMIN

## Необхідні зміни БД
- Створення таблиці executor_category_access:
  - id (PK)
  - executor_id (FK до auth_user)
  - category_id (FK до categories)
  - created_at
  - updated_at
  - UNIQUE constraint на (executor_id, category_id)
- Індекси:
  - executor_id для швидкої фільтрації доступів конкретного виконавця
  - category_id для перевірки, хто має доступ до категорії

## Вимоги/обмеження
- Тільки ADMIN може управляти доступами
- При видаленні виконавця - каскадне видалення його доступів
- При деактивації категорії - доступи зберігаються, але не використовуються
- Транзакційність при масовому додаванні/оновленні

## Визначення готовності (DoD)
- Модель ExecutorCategoryAccess створена та змігрована
- Всі CRUD ендпоінти для управління доступами працюють
- ADMIN може додавати/видаляти/оновлювати доступи виконавців
- Non-ADMIN отримують 403 при спробі доступу до ендпоінтів
- Валідації працюють коректно
- Унікальність пари executor-category забезпечена на рівні БД

## Тести
- Створення доступу виконавця до категорії
- Масове додавання доступів (кілька категорій одночасно)
- Отримання списку доступних категорій для виконавця
- Видалення доступу до конкретної категорії
- Масове оновлення доступів (заміна всіх)
- Спроба створити дублікат доступу (має бути помилка)
- Спроба додати доступ для не-EXECUTOR (має бути помилка)
- Спроба додати доступ до неіснуючої категорії (має бути помилка)
- EXECUTOR/OPERATOR отримують 403 при спробі управління доступами
- Каскадне видалення при видаленні виконавця

## Залежності
- BE-001 (модель User з ролями)
- BE-003 (модель Category)
- BE-008 (RBAC permissions)

## Позначки
- RBAC, Permissions, Category Access, Executor, Admin, Many-to-Many

