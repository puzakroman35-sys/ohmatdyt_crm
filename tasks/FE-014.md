# FE-014: Сторінка профілю користувача з можливістю зміни пароля

Фаза: 1 (MVP - розширення)
Тип: Frontend

## Мета
Створити сторінку профілю користувача `/profile` де користувач може переглянути свою інформацію та змінити власний пароль.

## Скоуп
- Створення сторінки `/profile`:
  - Відображення інформації про поточного користувача
  - Форма зміни пароля
  - Доступна для всіх авторизованих користувачів (OPERATOR, EXECUTOR, ADMIN)
  
- Інформація користувача (readonly):
  - ПІБ (full_name)
  - Username
  - Email
  - Роль (з кольоровим тегом як на сторінці користувачів)
  - Статус активності (Активний/Неактивний)
  - Дата створення акаунту
  - Дата останнього оновлення
  
- Для EXECUTOR додатково відображати:
  - Список доступних категорій (використати компонент ExecutorCategoryBadge з FE-013)
  - Якщо немає доступів - повідомлення "Немає доступних категорій"
  
- Форма зміни пароля:
  - Поле "Поточний пароль" (обов'язкове)
  - Поле "Новий пароль" (обов'язкове, мінімум 8 символів)
  - Поле "Підтвердження нового пароля" (обов'язкове)
  - Кнопка "Змінити пароль"
  
- Валідації форми:
  - Всі поля обов'язкові
  - Новий пароль >= 8 символів
  - Новий пароль повинен містити велику літеру
  - Новий пароль повинен містити маленьку літеру
  - Новий пароль повинен містити цифру
  - Новий пароль == Підтвердження пароля
  - Візуальний індикатор сили пароля (червоний/помаранчевий/зелений)
  
- Обробка помилок:
  - 401: "Поточний пароль невірний"
  - 400: Відобразити деталі помилки валідації
  - 422: "Новий пароль не може співпадати з поточним"
  - Success: "Пароль успішно змінено" + очистити форму
  
- UI компоненти:
  - Card для інформації про користувача
  - Card для форми зміни пароля
  - Form з Ant Design
  - Input.Password для полів паролів
  - Button з loading state
  - Notifications для успіху/помилок
  
## Структура файлів

### Основна сторінка:
**`frontend/src/pages/profile.tsx`**
- Основний компонент сторінки
- AuthGuard для перевірки авторизації
- Layout з MainLayout
- Два основні блоки: ProfileInfo + ChangePasswordForm

### Компоненти:
**`frontend/src/components/Profile/ProfileInfo.tsx`**
- Відображення readonly інформації про користувача
- Для EXECUTOR - список доступних категорій
- Props: user (з Redux state)

**`frontend/src/components/Profile/ChangePasswordForm.tsx`**
- Форма зміни пароля
- Власний стан для полів форми
- Валідація на клієнті
- API виклик через authSlice
- Props: onSuccess callback

**`frontend/src/components/Profile/index.ts`**
- Експорт компонентів

### Redux:
**Модифікація `frontend/src/store/slices/authSlice.ts`**
- Додати async thunk `changePasswordAsync`:
  ```typescript
  interface ChangePasswordRequest {
    current_password: string;
    new_password: string;
    confirm_password: string;
  }
  ```
- Endpoint: POST /api/auth/change-password
- Обробка помилок (401, 400, 422)

## API інтеграція

### Використовувані endpoints:
1. **GET /api/users/me** (вже існує)
   - Отримання інформації про поточного користувача
   - Використовується з Redux authSlice
   
2. **POST /api/auth/change-password** (BE-020)
   - Зміна пароля
   - Body: { current_password, new_password, confirm_password }
   - Response: { message, changed_at }
   
3. **GET /api/users/me/category-access** (вже існує, FE-013)
   - Тільки для EXECUTOR
   - Список доступних категорій

## Візуальний дизайн

### Layout:
```
+--------------------------------------------------+
|  Профіль користувача                             |
+--------------------------------------------------+
|                                                  |
|  +--------------------------------------------+  |
|  | Інформація про користувача                 |  |
|  |                                            |  |
|  | ПІБ: Іванов Іван Іванович                  |  |
|  | Username: ivanov                           |  |
|  | Email: ivanov@example.com                  |  |
|  | Роль: [EXECUTOR] (зелений тег)             |  |
|  | Статус: Активний                           |  |
|  | Створено: 15.10.2024 10:30                 |  |
|  |                                            |  |
|  | Доступні категорії:                        |  |
|  | [Медичні послуги] [Фінансова допомога]     |  |
|  +--------------------------------------------+  |
|                                                  |
|  +--------------------------------------------+  |
|  | Зміна пароля                               |  |
|  |                                            |  |
|  | Поточний пароль: [**********]              |  |
|  | Новий пароль: [**********]                 |  |
|  | Сила пароля: ████░░░░ Середній             |  |
|  | Підтвердження: [**********]                |  |
|  |                                            |  |
|  |           [Змінити пароль]                 |  |
|  +--------------------------------------------+  |
|                                                  |
+--------------------------------------------------+
```

## Вимоги/обмеження
- Доступ тільки для авторизованих користувачів (AuthGuard)
- Для EXECUTOR - автоматично завантажувати доступні категорії
- Форма зміни пароля повинна бути окремим компонентом
- Responsive дизайн (мобільні пристрої)
- Loading states для всіх операцій
- Proper error handling з зрозумілими повідомленнями
- Валідація на клієнті перед відправкою на сервер

## Визначення готовності (DoD)
- ✅ Сторінка `/profile` створена та доступна
- ✅ Відображається інформація про користувача з GET /api/users/me
- ✅ Для EXECUTOR відображаються доступні категорії
- ✅ Форма зміни пароля працює коректно
- ✅ Валідація нового пароля на клієнті (8+ символів, велика/маленька/цифра)
- ✅ Перевірка що новий пароль == підтвердження
- ✅ Індикатор сили пароля працює
- ✅ API виклик POST /api/auth/change-password реалізовано
- ✅ Success notification після успішної зміни пароля
- ✅ Error handling для 401, 400, 422
- ✅ Форма очищується після успішної зміни
- ✅ Responsive дизайн працює
- ✅ AuthGuard захищає сторінку
- ✅ Навігація з меню профілю працює

## Тести
- ✅ Сторінка відображається для OPERATOR
- ✅ Сторінка відображається для EXECUTOR з категоріями
- ✅ Сторінка відображається для EXECUTOR без категорій
- ✅ Сторінка відображається для ADMIN
- ✅ Інформація користувача відображається коректно
- ✅ Успішна зміна пароля
- ✅ Помилка при невірному поточному паролі (401)
- ✅ Помилка при короткому паролі (<8)
- ✅ Помилка при паролі без великої літери
- ✅ Помилка при паролі без маленької літери
- ✅ Помилка при паролі без цифри
- ✅ Помилка якщо новий пароль != підтвердження
- ✅ Форма очищується після успіху
- ✅ Loading state відображається під час запиту
- ✅ Індикатор сили пароля працює коректно
- ✅ Неавторизований користувач перенаправляється на /login
- ✅ Responsive на мобільних пристроях

## Залежності
- BE-020 (API зміни пароля)
- BE-002 (GET /api/users/me)
- FE-013 (ExecutorCategoryBadge component)
- FE-001 (MainLayout, AuthGuard)

## Позначки
- User Profile, Password Management, Self-Service, Security, UX

## Додаткові нотатки
- Сторінка доступна з dropdown меню профілю в header (вже є роут в MainLayout)
- В майбутньому можна додати можливість редагувати email та інші поля
- В майбутньому можна додати аватар користувача
- Індикатор сили пароля можна реалізувати через zxcvbn або простий алгоритм
- Роут `/profile` вже є в меню профілю (MainLayout.tsx line 77)
